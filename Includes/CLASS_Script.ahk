class Script
{ ; функции управления скриптом
	
	Force_Single_Instance()
	{ ; функция автоматического завершения всех копий текущего скрипта (одновременно для .exe и .ahk)
		static Detect_Hidden_Windows_Tmp
		static File_Types, Index, File_Type
		static Script_Name, Script_Full_Path
		;
		Detect_Hidden_Windows_Tmp := A_DetectHiddenWindows
		#SingleInstance Off
		DetectHiddenWindows On
		File_Types := [ ".exe", ".ahk" ]
		for Index, File_Type in File_Types {
			Script_Name := RegExReplace(A_ScriptName, "^(.*)\.(.*)$", "$1") . File_Type
			Script_Full_Path := A_ScriptDir . "\" . Script_Name
			This.Close_Other_Instances(Script_Full_Path . "ahk_class AutoHotkey")
		}
		DetectHiddenWindows % Detect_Hidden_Windows_Tmp
	}

	Close_Other_Instances(ByRef Script_Full_Path)
	{ ; функция завершения всех копий текущего скрипта (только для указанного файла)
		static Current_ID, Process_List, Process_Count, Process_ID, Process_PID
		;
		Script_Full_Path := Script_Full_Path ? Script_Full_Path : A_ScriptFullPath . " ahk_class AutoHotkey"
		WinGet Current_ID, ID, % A_ScriptFullPath . " ahk_class AutoHotkey"
		WinGet Process_List, List, % Script_Full_Path . " ahk_class AutoHotkey"
		Process_Count := 1
		Loop %Process_List%
		{
			Process_ID := Process_List%Process_Count%
			if (not Process_ID = Current_ID) {
				WinGet Process_PID, PID, % Script_Full_Path . " ahk_id " . Process_ID
				Process Close, %Process_PID%
			}
			Process_Count += 1
		}
	}

	Run_As_Admin(ByRef Params := "")
	{ ; функция запуска скрипта с правами администратора
		if (not A_IsAdmin) {
			Try {
				Run *RunAs "%A_ScriptFullPath%" %Params%
			}
			ExitApp
		}
	}
	
	Name()
	{ ; функция получения имени текущего скрипта
		static Name
		;
		SplitPath A_ScriptFullPath,,,, Name
		return Name
	}
}

